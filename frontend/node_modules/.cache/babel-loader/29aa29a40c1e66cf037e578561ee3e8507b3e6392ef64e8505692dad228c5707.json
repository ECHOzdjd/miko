{"ast":null,"code":"import React from'react';import{Link}from'react-router-dom';import{useQuery}from'react-query';import{MessageSquare,Clock}from'lucide-react';import{messagesApi}from'../api/messages';import{useAuthStore}from'../stores/authStore';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Conversations=()=>{const{user}=useAuthStore();const{data:conversationsData,isLoading}=useQuery({queryKey:['conversations'],queryFn:messagesApi.getConversations});const formatTime=dateString=>{const date=new Date(dateString);const now=new Date();const diff=now.getTime()-date.getTime();if(diff<60000){// 1分钟内\nreturn'刚刚';}else if(diff<3600000){// 1小时内\nreturn\"\".concat(Math.floor(diff/60000),\"\\u5206\\u949F\\u524D\");}else if(diff<86400000){// 24小时内\nreturn\"\".concat(Math.floor(diff/3600000),\"\\u5C0F\\u65F6\\u524D\");}else{return date.toLocaleDateString('zh-CN');}};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"})});}const conversations=(conversationsData===null||conversationsData===void 0?void 0:conversationsData.results)||[];return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto px-4 py-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"\\u79C1\\u4FE1\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:\"\\u4E0E\\u670B\\u53CB\\u548C\\u5173\\u6CE8\\u7684\\u4EBA\\u804A\\u5929\"})]}),conversations.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"\\u8FD8\\u6CA1\\u6709\\u5BF9\\u8BDD\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"\\u5F00\\u59CB\\u4E0E\\u670B\\u53CB\\u804A\\u5929\\u5427\\uFF01\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"divide-y divide-gray-200\",children:conversations.map(conversation=>{var _conversation$other_p,_conversation$other_p2,_conversation$other_p3;return/*#__PURE__*/_jsx(Link,{to:\"/chat/\".concat(conversation.id),className:\"block p-6 hover:bg-gray-50 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:((_conversation$other_p=conversation.other_participant)===null||_conversation$other_p===void 0?void 0:_conversation$other_p.avatar_url)||'/default-avatar.svg',alt:(_conversation$other_p2=conversation.other_participant)===null||_conversation$other_p2===void 0?void 0:_conversation$other_p2.nickname,className:\"w-12 h-12 rounded-full\"}),conversation.unread_count>0&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\",children:conversation.unread_count})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 truncate\",children:(_conversation$other_p3=conversation.other_participant)===null||_conversation$other_p3===void 0?void 0:_conversation$other_p3.nickname}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-sm text-gray-500\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:formatTime(conversation.updated_at)})]})]}),conversation.last_message&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 truncate mt-1\",children:[conversation.last_message.sender.id===(user===null||user===void 0?void 0:user.id)?'你: ':'',conversation.last_message.content]})]})]})},conversation.id);})})]})});};export default Conversations;","map":{"version":3,"names":["React","Link","useQuery","MessageSquare","Clock","messagesApi","useAuthStore","jsx","_jsx","jsxs","_jsxs","Conversations","user","data","conversationsData","isLoading","queryKey","queryFn","getConversations","formatTime","dateString","date","Date","now","diff","getTime","concat","Math","floor","toLocaleDateString","className","children","conversations","results","length","map","conversation","_conversation$other_p","_conversation$other_p2","_conversation$other_p3","to","id","src","other_participant","avatar_url","alt","nickname","unread_count","updated_at","last_message","sender","content"],"sources":["D:/miko/frontend/src/pages/Conversations.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useQuery } from 'react-query';\r\nimport { MessageSquare, Clock } from 'lucide-react';\r\nimport { messagesApi, Conversation } from '../api/messages';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nconst Conversations: React.FC = () => {\r\n  const { user } = useAuthStore();\r\n\r\n  const { data: conversationsData, isLoading } = useQuery({\r\n    queryKey: ['conversations'],\r\n    queryFn: messagesApi.getConversations,\r\n  });\r\n\r\n  const formatTime = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diff = now.getTime() - date.getTime();\r\n    \r\n    if (diff < 60000) { // 1分钟内\r\n      return '刚刚';\r\n    } else if (diff < 3600000) { // 1小时内\r\n      return `${Math.floor(diff / 60000)}分钟前`;\r\n    } else if (diff < 86400000) { // 24小时内\r\n      return `${Math.floor(diff / 3600000)}小时前`;\r\n    } else {\r\n      return date.toLocaleDateString('zh-CN');\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"text-gray-500\">加载中...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const conversations = conversationsData?.results || [];\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 py-6\">\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        <div className=\"p-6 border-b border-gray-200\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">私信</h1>\r\n          <p className=\"text-gray-600 mt-1\">与朋友和关注的人聊天</p>\r\n        </div>\r\n\r\n        {conversations.length === 0 ? (\r\n          <div className=\"p-8 text-center\">\r\n            <MessageSquare className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">还没有对话</h3>\r\n            <p className=\"text-gray-500\">开始与朋友聊天吧！</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"divide-y divide-gray-200\">\r\n            {conversations.map((conversation: Conversation) => (\r\n              <Link\r\n                key={conversation.id}\r\n                to={`/chat/${conversation.id}`}\r\n                className=\"block p-6 hover:bg-gray-50 transition-colors\"\r\n              >\r\n                <div className=\"flex items-center space-x-4\">\r\n                  <div className=\"relative\">\r\n                    <img\r\n                      src={conversation.other_participant?.avatar_url || '/default-avatar.svg'}\r\n                      alt={conversation.other_participant?.nickname}\r\n                      className=\"w-12 h-12 rounded-full\"\r\n                    />\r\n                    {conversation.unread_count > 0 && (\r\n                      <div className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n                        {conversation.unread_count}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h3 className=\"text-lg font-medium text-gray-900 truncate\">\r\n                        {conversation.other_participant?.nickname}\r\n                      </h3>\r\n                      <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\r\n                        <Clock className=\"w-4 h-4\" />\r\n                        <span>{formatTime(conversation.updated_at)}</span>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {conversation.last_message && (\r\n                      <p className=\"text-gray-600 truncate mt-1\">\r\n                        {conversation.last_message.sender.id === user?.id ? '你: ' : ''}\r\n                        {conversation.last_message.content}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </Link>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Conversations;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}