{"ast":null,"code":"import _objectSpread from\"D:/miko/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef,useEffect}from'react';import{useParams,Link}from'react-router-dom';import{Camera,Edit3,Save,X,Heart,MessageSquare,Users,FileText,Calendar,MapPin,Eye,EyeOff,UserPlus,UserMinus,Trash2}from'lucide-react';import{useAuthStore}from'../stores/authStore';import{useForm}from'react-hook-form';import{useQuery,useMutation,useQueryClient}from'react-query';import{authApi}from'../api/auth';import{postsApi}from'../api/posts';import{messagesApi}from'../api/messages';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Profile=()=>{var _watch;const{userId}=useParams();const{user,updateUser}=useAuthStore();const queryClient=useQueryClient();const fileInputRef=useRef(null);const[isEditing,setIsEditing]=useState(false);const[activeTab,setActiveTab]=useState('posts');const[avatarPreview,setAvatarPreview]=useState(null);const[showPrivateInfo,setShowPrivateInfo]=useState(false);const[deleteConfirm,setDeleteConfirm]=useState({show:false,postId:null,postTitle:''});const targetUserId=userId?parseInt(userId):user===null||user===void 0?void 0:user.id;const isOwnProfile=!userId||parseInt(userId)===(user===null||user===void 0?void 0:user.id);// 获取用户信息\nconst{data:profileUser,isLoading:userLoading}=useQuery({queryKey:['user',targetUserId],queryFn:()=>targetUserId?authApi.getUser(targetUserId):Promise.resolve(user),enabled:!!targetUserId});// 获取用户帖子\nconst{data:userPosts,isLoading:postsLoading}=useQuery({queryKey:['userPosts',targetUserId],queryFn:()=>targetUserId?authApi.getUserPosts(targetUserId):{results:[],count:0,next:null},enabled:!!targetUserId&&activeTab==='posts'});// 获取用户点赞的帖子\nconst{data:likedPosts,isLoading:likesLoading}=useQuery({queryKey:['userLikedPosts',targetUserId],queryFn:()=>targetUserId?authApi.getUserLikedPosts(targetUserId):{results:[],count:0,next:null},enabled:!!targetUserId&&activeTab==='likes'});// 获取关注列表\nconst{data:followingData,isLoading:followingLoading}=useQuery({queryKey:['userFollowing',targetUserId],queryFn:()=>targetUserId?authApi.getUserFollowing(targetUserId):{results:[],count:0},enabled:!!targetUserId&&activeTab==='following',staleTime:0,// 禁用缓存\ncacheTime:0// 禁用缓存\n});// 获取粉丝列表\nconst{data:followersData,isLoading:followersLoading}=useQuery({queryKey:['userFollowers',targetUserId],queryFn:()=>targetUserId?authApi.getUserFollowers(targetUserId):{results:[],count:0},enabled:!!targetUserId&&activeTab==='followers',staleTime:0,// 禁用缓存\ncacheTime:0// 禁用缓存\n});// 更新用户信息\nconst updateUserMutation=useMutation({mutationFn:authApi.updateUser,onSuccess:updatedUser=>{updateUser(updatedUser);queryClient.invalidateQueries(['user',targetUserId]);toast.success('资料更新成功！');setIsEditing(false);},onError:()=>{toast.error('更新失败，请稍后重试');}});// 上传头像\nconst uploadAvatarMutation=useMutation({mutationFn:authApi.uploadAvatar,onSuccess:updatedUser=>{console.log('头像上传成功，返回的用户信息:',updatedUser);console.log('新的头像URL:',updatedUser.avatar_url);updateUser(updatedUser);queryClient.invalidateQueries(['user',targetUserId]);// 立即清除预览，因为后端已经返回了新的头像URL\nsetAvatarPreview(null);toast.success('头像更新成功！');},onError:error=>{console.error('头像上传失败:',error);toast.error('头像上传失败，请稍后重试');setAvatarPreview(null);}});// 关注/取消关注\nconst followMutation=useMutation({mutationFn:userId=>profileUser!==null&&profileUser!==void 0&&profileUser.is_following?authApi.unfollowUser(userId):authApi.followUser(userId),onSuccess:()=>{queryClient.invalidateQueries(['user',targetUserId]);queryClient.invalidateQueries(['userFollowers',targetUserId]);toast.success(profileUser!==null&&profileUser!==void 0&&profileUser.is_following?'已取消关注':'关注成功');},onError:()=>{toast.error('操作失败，请稍后重试');}});// 删除帖子\nconst deletePostMutation=useMutation({mutationFn:postId=>postsApi.deletePost(postId),onSuccess:()=>{queryClient.invalidateQueries(['userPosts',targetUserId]);queryClient.invalidateQueries(['user',targetUserId]);setDeleteConfirm({show:false,postId:null,postTitle:''});toast.success('帖子删除成功');},onError:()=>{toast.error('删除失败，请稍后重试');}});// 开始对话\nconst startConversationMutation=useMutation({mutationFn:userId=>messagesApi.startConversation({user_id:userId}),onSuccess:conversation=>{// 跳转到聊天页面\nwindow.location.href=\"/chat/\".concat(conversation.id);},onError:err=>{var _err$response,_err$response$data;console.error('开始对话失败:',err);toast.error(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||'开始对话失败，请稍后重试');}});const{register,handleSubmit,reset,watch,formState:{errors}}=useForm({defaultValues:{nickname:(profileUser===null||profileUser===void 0?void 0:profileUser.nickname)||'',signature:(profileUser===null||profileUser===void 0?void 0:profileUser.signature)||'',bio:(profileUser===null||profileUser===void 0?void 0:profileUser.bio)||'',birthday:(profileUser===null||profileUser===void 0?void 0:profileUser.birthday)||'',gender:(profileUser===null||profileUser===void 0?void 0:profileUser.gender)||'',location:(profileUser===null||profileUser===void 0?void 0:profileUser.location)||''}});// 当用户数据加载完成时重置表单\nuseEffect(()=>{if(profileUser){reset({nickname:profileUser.nickname||'',signature:profileUser.signature||'',bio:profileUser.bio||'',birthday:profileUser.birthday||'',gender:profileUser.gender||'',location:profileUser.location||''});}},[profileUser,reset]);const handleAvatarChange=event=>{var _event$target$files;const file=(_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0];if(file){if(file.size>5*1024*1024){toast.error('头像文件不能超过5MB');return;}const reader=new FileReader();reader.onload=e=>{var _e$target;setAvatarPreview((_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.result);};reader.readAsDataURL(file);// 立即上传头像\nuploadAvatarMutation.mutate(file);}};const onSubmit=async data=>{updateUserMutation.mutate(data);};const handleFollow=()=>{if(targetUserId){followMutation.mutate(targetUserId);}};const handleDeletePost=(postId,postTitle)=>{setDeleteConfirm({show:true,postId,postTitle});};const confirmDeletePost=()=>{if(deleteConfirm.postId){deletePostMutation.mutate(deleteConfirm.postId);}};const cancelDeletePost=()=>{setDeleteConfirm({show:false,postId:null,postTitle:''});};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('zh-CN',{year:'numeric',month:'long',day:'numeric'});};const getGenderText=gender=>{switch(gender){case'male':return'男';case'female':return'女';case'other':return'其他';default:return'未设置';}};const getAge=birthday=>{if(!birthday)return null;const today=new Date();const birthDate=new Date(birthday);let age=today.getFullYear()-birthDate.getFullYear();const monthDiff=today.getMonth()-birthDate.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birthDate.getDate()){age--;}return age;};const renderTabContent=()=>{var _userPosts$results,_likedPosts$results,_followingData$result,_followersData$result;switch(activeTab){case'posts':if(postsLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"});}if(!(userPosts!==null&&userPosts!==void 0&&(_userPosts$results=userPosts.results)!==null&&_userPosts$results!==void 0&&_userPosts$results.length)){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u6682\\u65E0\\u5E16\\u5B50\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:userPosts.results.map(post=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer group\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/post/\".concat(post.id),className:\"block\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium text-gray-900 group-hover:text-primary-600 mb-2 transition-colors\",children:post.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-3 line-clamp-2\",children:post.content}),post.images&&post.images.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-2\",children:post.images.slice(0,3).map((imageUrl,index)=>/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:\"\\u56FE\\u7247 \".concat(index+1),className:\"w-full h-20 object-cover rounded\"},index))}),post.images.length>3&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"\\u8FD8\\u6709 \",post.images.length-3,\" \\u5F20\\u56FE\\u7247...\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-4 h-4 mr-1\"}),post.likes_count||0]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-4 h-4 mr-1\"}),post.comments_count||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:new Date(post.created_at).toLocaleDateString()}),isOwnProfile&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.preventDefault();e.stopPropagation();handleDeletePost(post.id,post.title);},className:\"text-red-500 hover:text-red-700 p-1 rounded transition-colors\",title:\"\\u5220\\u9664\\u5E16\\u5B50\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})]})]})]},post.id))});case'likes':if(likesLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"});}if(!(likedPosts!==null&&likedPosts!==void 0&&(_likedPosts$results=likedPosts.results)!==null&&_likedPosts$results!==void 0&&_likedPosts$results.length)){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u6682\\u65E0\\u70B9\\u8D5E\\u7684\\u5E16\\u5B50\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:likedPosts.results.map(post=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer group\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/post/\".concat(post.id),className:\"block\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium text-gray-900 group-hover:text-primary-600 mb-2 transition-colors\",children:post.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-3 line-clamp-2\",children:post.content}),post.images&&post.images.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-2\",children:post.images.slice(0,3).map((imageUrl,index)=>/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:\"\\u56FE\\u7247 \".concat(index+1),className:\"w-full h-20 object-cover rounded\"},index))}),post.images.length>3&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"\\u8FD8\\u6709 \",post.images.length-3,\" \\u5F20\\u56FE\\u7247...\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center text-red-500\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-4 h-4 mr-1 fill-current\"}),\"\\u5DF2\\u70B9\\u8D5E\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-4 h-4 mr-1\"}),post.comments_count||0]})]}),/*#__PURE__*/_jsx(\"span\",{children:new Date(post.created_at).toLocaleDateString()})]})]},post.id))});case'following':if(followingLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"});}if(!(followingData!==null&&followingData!==void 0&&(_followingData$result=followingData.results)!==null&&_followingData$result!==void 0&&_followingData$result.length)){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u6682\\u65E0\\u5173\\u6CE8\\u7684\\u7528\\u6237\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:followingData.results.map(followUser=>/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg border border-gray-200 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(followUser.id),children:/*#__PURE__*/_jsx(\"img\",{src:followUser.avatar_url,alt:followUser.nickname,className:\"w-12 h-12 rounded-full hover:opacity-80 transition-opacity cursor-pointer\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(followUser.id),className:\"font-medium text-gray-900 hover:text-primary-600\",children:followUser.nickname}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mt-1\",children:followUser.signature}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[followUser.followers_count,\" \\u7C89\\u4E1D\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>followMutation.mutate(followUser.id),disabled:followMutation.isLoading,className:\"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 transition-all duration-200 hover:shadow-sm\",children:followMutation.isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin\"}),\"\\u5904\\u7406\\u4E2D\"]}):'已关注'})]})},followUser.id))});case'followers':if(followersLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u52A0\\u8F7D\\u4E2D...\"});}if(!(followersData!==null&&followersData!==void 0&&(_followersData$result=followersData.results)!==null&&_followersData$result!==void 0&&_followersData$result.length)){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:\"\\u6682\\u65E0\\u7C89\\u4E1D\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:followersData.results.map(follower=>/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg border border-gray-200 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(follower.id),children:/*#__PURE__*/_jsx(\"img\",{src:follower.avatar_url,alt:follower.nickname,className:\"w-12 h-12 rounded-full hover:opacity-80 transition-opacity cursor-pointer\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(follower.id),className:\"font-medium text-gray-900 hover:text-primary-600\",children:follower.nickname}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mt-1\",children:follower.signature}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[follower.followers_count,\" \\u7C89\\u4E1D\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>followMutation.mutate(follower.id),disabled:followMutation.isLoading,className:\"px-3 py-1 text-sm rounded-md disabled:opacity-50 transition-all duration-200 \".concat(follower.is_following?'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm':'bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md'),children:followMutation.isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin\"}),\"\\u5904\\u7406\\u4E2D\"]}):follower.is_following?'已关注':'关注'})]})},follower.id))});default:return null;}};if(userLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto py-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"animate-pulse\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-32 bg-gray-300 rounded-t-lg mb-4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-32 h-32 bg-gray-300 rounded-full\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-6 bg-gray-300 rounded w-1/3 mb-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-4 bg-gray-300 rounded w-1/2\"})]})]})]})})});}if(!profileUser){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto py-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"\\u7528\\u6237\\u4E0D\\u5B58\\u5728\"})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto py-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-48 bg-gradient-to-r from-primary-400 to-primary-600 rounded-t-lg relative\",style:{backgroundImage:profileUser.background_url?\"url(\".concat(profileUser.background_url,\")\"):undefined,backgroundSize:'cover',backgroundPosition:'center'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 pb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-end sm:space-x-6 -mt-16 relative\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:avatarPreview||(profileUser===null||profileUser===void 0?void 0:profileUser.avatar_url)||'/default-avatar.svg',alt:(profileUser===null||profileUser===void 0?void 0:profileUser.nickname)||'用户',className:\"w-32 h-32 rounded-full border-4 border-white shadow-lg\",onError:e=>{// 如果头像加载失败，使用默认头像\ne.currentTarget.src='/default-avatar.svg';}}),isOwnProfile&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},disabled:uploadAvatarMutation.isLoading,className:\"absolute bottom-2 right-2 p-2 bg-primary-600 text-white rounded-full hover:bg-primary-700 disabled:opacity-50\",children:/*#__PURE__*/_jsx(Camera,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\"image/*\",onChange:handleAvatarChange,className:\"hidden\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 mt-4 sm:mt-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:profileUser.nickname}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:profileUser.signature}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mt-2\",children:profileUser.bio}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 space-y-1\",children:[profileUser.birthday&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-4 h-4 mr-2\"}),formatDate(profileUser.birthday),getAge(profileUser.birthday)&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-gray-500\",children:[\"(\",getAge(profileUser.birthday),\"\\u5C81)\"]})]}),profileUser.gender&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 mr-2\"}),getGenderText(profileUser.gender)]}),profileUser.location&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-2\"}),profileUser.location]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-4 h-4 mr-2\"}),\"\\u52A0\\u5165\\u4E8E \",formatDate(profileUser.created_at)]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-3 mt-4 sm:mt-0\",children:isOwnProfile?/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setIsEditing(!isEditing),className:\"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\",children:[isEditing?/*#__PURE__*/_jsx(X,{className:\"w-4 h-4 mr-2\"}):/*#__PURE__*/_jsx(Edit3,{className:\"w-4 h-4 mr-2\"}),isEditing?'取消':'编辑资料']}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleFollow,disabled:followMutation.isLoading,className:\"flex items-center px-4 py-2 rounded-md disabled:opacity-50 transition-all duration-200 \".concat(profileUser.is_following?'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm':'bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md'),children:followMutation.isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin\"}),\"\\u5904\\u7406\\u4E2D...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[profileUser.is_following?/*#__PURE__*/_jsx(UserMinus,{className:\"w-4 h-4 mr-2\"}):/*#__PURE__*/_jsx(UserPlus,{className:\"w-4 h-4 mr-2\"}),profileUser.is_following?'已关注':'关注']})}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{if(targetUserId){startConversationMutation.mutate(targetUserId);}},disabled:startConversationMutation.isLoading,className:\"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-4 h-4 mr-2\"}),\"\\u79C1\\u4FE1\"]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6 mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-gray-900\",children:profileUser.posts_count||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"\\u5E16\\u5B50\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-gray-900\",children:profileUser.followers_count||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"\\u7C89\\u4E1D\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-gray-900\",children:profileUser.following_count||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"\\u5173\\u6CE8\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-gray-900\",children:profileUser.likes_received||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"\\u83B7\\u8D5E\"})]})]})]})]}),isEditing&&isOwnProfile&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),className:\"mt-6 p-6 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:\"\\u7F16\\u8F91\\u4E2A\\u4EBA\\u8D44\\u6599\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u6635\\u79F0 *\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('nickname',{required:'请输入昵称'})),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\",placeholder:\"\\u8BF7\\u8F93\\u5165\\u6635\\u79F0\"})),errors.nickname&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.nickname.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u6027\\u522B\"}),/*#__PURE__*/_jsxs(\"select\",_objectSpread(_objectSpread({},register('gender')),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u8BF7\\u9009\\u62E9\\u6027\\u522B\"}),/*#__PURE__*/_jsx(\"option\",{value:\"male\",children:\"\\u7537\"}),/*#__PURE__*/_jsx(\"option\",{value:\"female\",children:\"\\u5973\"}),/*#__PURE__*/_jsx(\"option\",{value:\"other\",children:\"\\u5176\\u4ED6\"})]}))]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u751F\\u65E5\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('birthday')),{},{type:\"date\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"}))]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u6240\\u5728\\u5730\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('location')),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\",placeholder:\"\\u8BF7\\u8F93\\u5165\\u6240\\u5728\\u5730\"}))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u4E2A\\u6027\\u7B7E\\u540D\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('signature')),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\",placeholder:\"\\u5199\\u70B9\\u4EC0\\u4E48\\u4ECB\\u7ECD\\u4E00\\u4E0B\\u81EA\\u5DF1...\",maxLength:200}))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u4E2A\\u4EBA\\u7B80\\u4ECB\"}),/*#__PURE__*/_jsx(\"textarea\",_objectSpread(_objectSpread({},register('bio')),{},{rows:4,className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\",placeholder:\"\\u8BE6\\u7EC6\\u4ECB\\u7ECD\\u4E00\\u4E0B\\u81EA\\u5DF1...\",maxLength:500})),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 text-right text-sm text-gray-500\",children:[((_watch=watch('bio'))===null||_watch===void 0?void 0:_watch.length)||0,\" / 500\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:updateUserMutation.isLoading,className:\"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50\",children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2\"}),updateUserMutation.isLoading?'保存中...':'保存']}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setIsEditing(false);reset();},className:\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\",children:\"\\u53D6\\u6D88\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2 text-sm text-gray-500\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowPrivateInfo(!showPrivateInfo),className:\"flex items-center hover:text-gray-700\",children:[showPrivateInfo?/*#__PURE__*/_jsx(EyeOff,{className:\"w-4 h-4 mr-1\"}):/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4 mr-1\"}),showPrivateInfo?'隐藏':'显示',\"\\u9690\\u79C1\\u4FE1\\u606F\"]})})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"flex space-x-8 px-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('posts'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='posts'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 inline mr-2\"}),\"\\u6211\\u7684\\u5E16\\u5B50 (\",profileUser.posts_count||0,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('likes'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='likes'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Heart,{className:\"w-4 h-4 inline mr-2\"}),\"\\u6211\\u7684\\u70B9\\u8D5E\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('following'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='following'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 inline mr-2\"}),\"\\u6211\\u7684\\u5173\\u6CE8 (\",profileUser.following_count||0,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('followers'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='followers'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 inline mr-2\"}),\"\\u6211\\u7684\\u7C89\\u4E1D (\",profileUser.followers_count||0,\")\"]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:renderTabContent()})]}),deleteConfirm.show&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 max-w-md w-full mx-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-6 h-6 text-red-600\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"\\u5220\\u9664\\u5E16\\u5B50\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:[\"\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u5E16\\u5B50 \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"\\\"\",deleteConfirm.postTitle,\"\\\"\"]}),\" \\u5417\\uFF1F\\u6B64\\u64CD\\u4F5C\\u65E0\\u6CD5\\u64A4\\u9500\\u3002\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:cancelDeletePost,className:\"flex-1 bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 transition-colors\",children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"button\",{onClick:confirmDeletePost,disabled:deletePostMutation.isLoading,className:\"flex-1 bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50 transition-colors\",children:deletePostMutation.isLoading?'删除中...':'删除'})]})]})]})})]});};export default Profile;","map":{"version":3,"names":["React","useState","useRef","useEffect","useParams","Link","Camera","Edit3","Save","X","Heart","MessageSquare","Users","FileText","Calendar","MapPin","Eye","EyeOff","UserPlus","UserMinus","Trash2","useAuthStore","useForm","useQuery","useMutation","useQueryClient","authApi","postsApi","messagesApi","toast","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Profile","_watch","userId","user","updateUser","queryClient","fileInputRef","isEditing","setIsEditing","activeTab","setActiveTab","avatarPreview","setAvatarPreview","showPrivateInfo","setShowPrivateInfo","deleteConfirm","setDeleteConfirm","show","postId","postTitle","targetUserId","parseInt","id","isOwnProfile","data","profileUser","isLoading","userLoading","queryKey","queryFn","getUser","Promise","resolve","enabled","userPosts","postsLoading","getUserPosts","results","count","next","likedPosts","likesLoading","getUserLikedPosts","followingData","followingLoading","getUserFollowing","staleTime","cacheTime","followersData","followersLoading","getUserFollowers","updateUserMutation","mutationFn","onSuccess","updatedUser","invalidateQueries","success","onError","error","uploadAvatarMutation","uploadAvatar","console","log","avatar_url","followMutation","is_following","unfollowUser","followUser","deletePostMutation","deletePost","startConversationMutation","startConversation","user_id","conversation","window","location","href","concat","err","_err$response","_err$response$data","response","detail","register","handleSubmit","reset","watch","formState","errors","defaultValues","nickname","signature","bio","birthday","gender","handleAvatarChange","event","_event$target$files","file","target","files","size","reader","FileReader","onload","e","_e$target","result","readAsDataURL","mutate","onSubmit","handleFollow","handleDeletePost","confirmDeletePost","cancelDeletePost","formatDate","dateString","Date","toLocaleDateString","year","month","day","getGenderText","getAge","today","birthDate","age","getFullYear","monthDiff","getMonth","getDate","renderTabContent","_userPosts$results","_likedPosts$results","_followingData$result","_followersData$result","className","children","length","map","post","to","title","content","images","slice","imageUrl","index","src","alt","likes_count","comments_count","created_at","onClick","preventDefault","stopPropagation","followers_count","disabled","follower","style","backgroundImage","background_url","undefined","backgroundSize","backgroundPosition","currentTarget","_fileInputRef$current","current","click","ref","type","accept","onChange","posts_count","following_count","likes_received","_objectSpread","required","placeholder","message","value","maxLength","rows"],"sources":["D:/miko/frontend/src/pages/Profile.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { \r\n  Camera, Edit3, Save, X, Heart, MessageSquare, Users, FileText, \r\n  Calendar, MapPin, Eye, EyeOff,\r\n  UserPlus, UserMinus, Trash2\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useForm } from 'react-hook-form';\r\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\r\nimport { authApi } from '../api/auth';\r\nimport { postsApi } from '../api/posts';\r\nimport { messagesApi } from '../api/messages';\r\nimport toast from 'react-hot-toast';\r\n\r\ninterface ProfileForm {\r\n  nickname: string;\r\n  signature: string;\r\n  bio: string;\r\n  birthday: string;\r\n  gender: 'male' | 'female' | 'other' | '';\r\n  location: string;\r\n}\r\n\r\nconst Profile: React.FC = () => {\r\n  const { userId } = useParams<{ userId: string }>();\r\n  const { user, updateUser } = useAuthStore();\r\n  const queryClient = useQueryClient();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  \r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<'posts' | 'likes' | 'following' | 'followers'>('posts');\r\n  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);\r\n  const [showPrivateInfo, setShowPrivateInfo] = useState(false);\r\n  const [deleteConfirm, setDeleteConfirm] = useState<{ show: boolean; postId: number | null; postTitle: string }>({\r\n    show: false,\r\n    postId: null,\r\n    postTitle: ''\r\n  });\r\n\r\n  const targetUserId = userId ? parseInt(userId) : user?.id;\r\n  const isOwnProfile = !userId || parseInt(userId) === user?.id;\r\n\r\n  // 获取用户信息\r\n  const { data: profileUser, isLoading: userLoading } = useQuery({\r\n    queryKey: ['user', targetUserId],\r\n    queryFn: () => targetUserId ? authApi.getUser(targetUserId) : Promise.resolve(user),\r\n    enabled: !!targetUserId,\r\n  });\r\n\r\n  // 获取用户帖子\r\n  const { data: userPosts, isLoading: postsLoading } = useQuery({\r\n    queryKey: ['userPosts', targetUserId],\r\n    queryFn: () => targetUserId ? authApi.getUserPosts(targetUserId) : { results: [], count: 0, next: null },\r\n    enabled: !!targetUserId && activeTab === 'posts',\r\n  });\r\n\r\n  // 获取用户点赞的帖子\r\n  const { data: likedPosts, isLoading: likesLoading } = useQuery({\r\n    queryKey: ['userLikedPosts', targetUserId],\r\n    queryFn: () => targetUserId ? authApi.getUserLikedPosts(targetUserId) : { results: [], count: 0, next: null },\r\n    enabled: !!targetUserId && activeTab === 'likes',\r\n  });\r\n\r\n  // 获取关注列表\r\n  const { data: followingData, isLoading: followingLoading } = useQuery({\r\n    queryKey: ['userFollowing', targetUserId],\r\n    queryFn: () => targetUserId ? authApi.getUserFollowing(targetUserId) : { results: [], count: 0 },\r\n    enabled: !!targetUserId && activeTab === 'following',\r\n    staleTime: 0, // 禁用缓存\r\n    cacheTime: 0, // 禁用缓存\r\n  });\r\n\r\n\r\n  // 获取粉丝列表\r\n  const { data: followersData, isLoading: followersLoading } = useQuery({\r\n    queryKey: ['userFollowers', targetUserId],\r\n    queryFn: () => targetUserId ? authApi.getUserFollowers(targetUserId) : { results: [], count: 0 },\r\n    enabled: !!targetUserId && activeTab === 'followers',\r\n    staleTime: 0, // 禁用缓存\r\n    cacheTime: 0, // 禁用缓存\r\n  });\r\n\r\n  // 更新用户信息\r\n  const updateUserMutation = useMutation({\r\n    mutationFn: authApi.updateUser,\r\n    onSuccess: (updatedUser) => {\r\n      updateUser(updatedUser);\r\n      queryClient.invalidateQueries(['user', targetUserId]);\r\n      toast.success('资料更新成功！');\r\n      setIsEditing(false);\r\n    },\r\n    onError: () => {\r\n      toast.error('更新失败，请稍后重试');\r\n    },\r\n  });\r\n\r\n  // 上传头像\r\n  const uploadAvatarMutation = useMutation({\r\n    mutationFn: authApi.uploadAvatar,\r\n    onSuccess: (updatedUser) => {\r\n      console.log('头像上传成功，返回的用户信息:', updatedUser);\r\n      console.log('新的头像URL:', updatedUser.avatar_url);\r\n      updateUser(updatedUser);\r\n      queryClient.invalidateQueries(['user', targetUserId]);\r\n      // 立即清除预览，因为后端已经返回了新的头像URL\r\n      setAvatarPreview(null);\r\n      toast.success('头像更新成功！');\r\n    },\r\n    onError: (error) => {\r\n      console.error('头像上传失败:', error);\r\n      toast.error('头像上传失败，请稍后重试');\r\n      setAvatarPreview(null);\r\n    },\r\n  });\r\n\r\n  // 关注/取消关注\r\n  const followMutation = useMutation({\r\n    mutationFn: (userId: number) => \r\n      profileUser?.is_following ? authApi.unfollowUser(userId) : authApi.followUser(userId),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['user', targetUserId]);\r\n      queryClient.invalidateQueries(['userFollowers', targetUserId]);\r\n      toast.success(profileUser?.is_following ? '已取消关注' : '关注成功');\r\n    },\r\n    onError: () => {\r\n      toast.error('操作失败，请稍后重试');\r\n    },\r\n  });\r\n\r\n  // 删除帖子\r\n  const deletePostMutation = useMutation({\r\n    mutationFn: (postId: number) => postsApi.deletePost(postId),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries(['userPosts', targetUserId]);\r\n      queryClient.invalidateQueries(['user', targetUserId]);\r\n      setDeleteConfirm({ show: false, postId: null, postTitle: '' });\r\n      toast.success('帖子删除成功');\r\n    },\r\n    onError: () => {\r\n      toast.error('删除失败，请稍后重试');\r\n    },\r\n  });\r\n\r\n  // 开始对话\r\n  const startConversationMutation = useMutation({\r\n    mutationFn: (userId: number) => messagesApi.startConversation({ user_id: userId }),\r\n    onSuccess: (conversation) => {\r\n      // 跳转到聊天页面\r\n      window.location.href = `/chat/${conversation.id}`;\r\n    },\r\n    onError: (err: any) => {\r\n      console.error('开始对话失败:', err);\r\n      toast.error(err.response?.data?.detail || '开始对话失败，请稍后重试');\r\n    },\r\n  });\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    reset,\r\n    watch,\r\n    formState: { errors },\r\n  } = useForm<ProfileForm>({\r\n    defaultValues: {\r\n      nickname: profileUser?.nickname || '',\r\n      signature: profileUser?.signature || '',\r\n      bio: profileUser?.bio || '',\r\n      birthday: profileUser?.birthday || '',\r\n      gender: profileUser?.gender || '',\r\n      location: profileUser?.location || '',\r\n    },\r\n  });\r\n\r\n  // 当用户数据加载完成时重置表单\r\n  useEffect(() => {\r\n    if (profileUser) {\r\n      reset({\r\n        nickname: profileUser.nickname || '',\r\n        signature: profileUser.signature || '',\r\n        bio: profileUser.bio || '',\r\n        birthday: profileUser.birthday || '',\r\n        gender: profileUser.gender || '',\r\n        location: profileUser.location || '',\r\n      });\r\n    }\r\n  }, [profileUser, reset]);\r\n\r\n  const handleAvatarChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast.error('头像文件不能超过5MB');\r\n        return;\r\n      }\r\n\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        setAvatarPreview(e.target?.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n\r\n      // 立即上传头像\r\n      uploadAvatarMutation.mutate(file);\r\n    }\r\n  };\r\n\r\n  const onSubmit = async (data: ProfileForm) => {\r\n    updateUserMutation.mutate(data);\r\n  };\r\n\r\n  const handleFollow = () => {\r\n    if (targetUserId) {\r\n      followMutation.mutate(targetUserId);\r\n    }\r\n  };\r\n\r\n  const handleDeletePost = (postId: number, postTitle: string) => {\r\n    setDeleteConfirm({ show: true, postId, postTitle });\r\n  };\r\n\r\n  const confirmDeletePost = () => {\r\n    if (deleteConfirm.postId) {\r\n      deletePostMutation.mutate(deleteConfirm.postId);\r\n    }\r\n  };\r\n\r\n  const cancelDeletePost = () => {\r\n    setDeleteConfirm({ show: false, postId: null, postTitle: '' });\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('zh-CN', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const getGenderText = (gender: string) => {\r\n    switch (gender) {\r\n      case 'male': return '男';\r\n      case 'female': return '女';\r\n      case 'other': return '其他';\r\n      default: return '未设置';\r\n    }\r\n  };\r\n\r\n  const getAge = (birthday: string) => {\r\n    if (!birthday) return null;\r\n    const today = new Date();\r\n    const birthDate = new Date(birthday);\r\n    let age = today.getFullYear() - birthDate.getFullYear();\r\n    const monthDiff = today.getMonth() - birthDate.getMonth();\r\n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {\r\n      age--;\r\n    }\r\n    return age;\r\n  };\r\n\r\n  const renderTabContent = () => {\r\n    switch (activeTab) {\r\n      case 'posts':\r\n        if (postsLoading) {\r\n          return <div className=\"text-center py-8 text-gray-500\">加载中...</div>;\r\n        }\r\n        \r\n        if (!userPosts?.results?.length) {\r\n          return <div className=\"text-center py-8 text-gray-500\">暂无帖子</div>;\r\n        }\r\n\r\n        return (\r\n          <div className=\"space-y-4\">\r\n            {userPosts.results.map((post: any) => (\r\n              <div key={post.id} className=\"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer group\">\r\n                <Link to={`/post/${post.id}`} className=\"block\">\r\n                  <h3 className=\"font-medium text-gray-900 group-hover:text-primary-600 mb-2 transition-colors\">\r\n                    {post.title}\r\n                  </h3>\r\n                  <p className=\"text-gray-600 text-sm mb-3 line-clamp-2\">\r\n                    {post.content}\r\n                  </p>\r\n                  \r\n                  {/* 图片预览 */}\r\n                  {post.images && post.images.length > 0 && (\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"grid grid-cols-3 gap-2\">\r\n                        {post.images.slice(0, 3).map((imageUrl: string, index: number) => (\r\n                          <img\r\n                            key={index}\r\n                            src={imageUrl}\r\n                            alt={`图片 ${index + 1}`}\r\n                            className=\"w-full h-20 object-cover rounded\"\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                      {post.images.length > 3 && (\r\n                        <p className=\"text-xs text-gray-500 mt-1\">\r\n                          还有 {post.images.length - 3} 张图片...\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </Link>\r\n                \r\n                <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n                  <div className=\"flex items-center space-x-4\">\r\n                    <span className=\"flex items-center\">\r\n                      <Heart className=\"w-4 h-4 mr-1\" />\r\n                      {post.likes_count || 0}\r\n                    </span>\r\n                    <span className=\"flex items-center\">\r\n                      <MessageSquare className=\"w-4 h-4 mr-1\" />\r\n                      {post.comments_count || 0}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <span>{new Date(post.created_at).toLocaleDateString()}</span>\r\n                    {isOwnProfile && (\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          handleDeletePost(post.id, post.title);\r\n                        }}\r\n                        className=\"text-red-500 hover:text-red-700 p-1 rounded transition-colors\"\r\n                        title=\"删除帖子\"\r\n                      >\r\n                        <Trash2 className=\"w-4 h-4\" />\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        );\r\n      \r\n      case 'likes':\r\n        if (likesLoading) {\r\n          return <div className=\"text-center py-8 text-gray-500\">加载中...</div>;\r\n        }\r\n        \r\n        if (!likedPosts?.results?.length) {\r\n          return <div className=\"text-center py-8 text-gray-500\">暂无点赞的帖子</div>;\r\n        }\r\n\r\n        return (\r\n          <div className=\"space-y-4\">\r\n            {likedPosts.results.map((post: any) => (\r\n              <div key={post.id} className=\"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer group\">\r\n                <Link to={`/post/${post.id}`} className=\"block\">\r\n                  <h3 className=\"font-medium text-gray-900 group-hover:text-primary-600 mb-2 transition-colors\">\r\n                    {post.title}\r\n                  </h3>\r\n                  <p className=\"text-gray-600 text-sm mb-3 line-clamp-2\">\r\n                    {post.content}\r\n                  </p>\r\n                  \r\n                  {/* 图片预览 */}\r\n                  {post.images && post.images.length > 0 && (\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"grid grid-cols-3 gap-2\">\r\n                        {post.images.slice(0, 3).map((imageUrl: string, index: number) => (\r\n                          <img\r\n                            key={index}\r\n                            src={imageUrl}\r\n                            alt={`图片 ${index + 1}`}\r\n                            className=\"w-full h-20 object-cover rounded\"\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                      {post.images.length > 3 && (\r\n                        <p className=\"text-xs text-gray-500 mt-1\">\r\n                          还有 {post.images.length - 3} 张图片...\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </Link>\r\n                \r\n                <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n                  <div className=\"flex items-center space-x-4\">\r\n                    <span className=\"flex items-center text-red-500\">\r\n                      <Heart className=\"w-4 h-4 mr-1 fill-current\" />\r\n                      已点赞\r\n                    </span>\r\n                    <span className=\"flex items-center\">\r\n                      <MessageSquare className=\"w-4 h-4 mr-1\" />\r\n                      {post.comments_count || 0}\r\n                    </span>\r\n                  </div>\r\n                  <span>{new Date(post.created_at).toLocaleDateString()}</span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        );\r\n      \r\n      case 'following':\r\n        if (followingLoading) {\r\n          return <div className=\"text-center py-8 text-gray-500\">加载中...</div>;\r\n        }\r\n        \r\n        if (!followingData?.results?.length) {\r\n          return <div className=\"text-center py-8 text-gray-500\">暂无关注的用户</div>;\r\n        }\r\n\r\n        return (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {followingData.results.map((followUser: any) => (\r\n              <div key={followUser.id} className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <Link to={`/profile/${followUser.id}`}>\r\n                    <img\r\n                      src={followUser.avatar_url}\r\n                      alt={followUser.nickname}\r\n                      className=\"w-12 h-12 rounded-full hover:opacity-80 transition-opacity cursor-pointer\"\r\n                    />\r\n                  </Link>\r\n                  <div className=\"flex-1\">\r\n                    <Link\r\n                      to={`/profile/${followUser.id}`}\r\n                      className=\"font-medium text-gray-900 hover:text-primary-600\"\r\n                    >\r\n                      {followUser.nickname}\r\n                    </Link>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">{followUser.signature}</p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                      {followUser.followers_count} 粉丝\r\n                    </p>\r\n                  </div>\r\n                  <button \r\n                    onClick={() => followMutation.mutate(followUser.id)}\r\n                    disabled={followMutation.isLoading}\r\n                    className=\"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 transition-all duration-200 hover:shadow-sm\"\r\n                  >\r\n                    {followMutation.isLoading ? (\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"w-3 h-3 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin\"></div>\r\n                        处理中\r\n                      </div>\r\n                    ) : '已关注'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        );\r\n      \r\n      case 'followers':\r\n        if (followersLoading) {\r\n          return <div className=\"text-center py-8 text-gray-500\">加载中...</div>;\r\n        }\r\n        \r\n        if (!followersData?.results?.length) {\r\n          return <div className=\"text-center py-8 text-gray-500\">暂无粉丝</div>;\r\n        }\r\n\r\n        return (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {followersData.results.map((follower: any) => (\r\n              <div key={follower.id} className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <Link to={`/profile/${follower.id}`}>\r\n                    <img\r\n                      src={follower.avatar_url}\r\n                      alt={follower.nickname}\r\n                      className=\"w-12 h-12 rounded-full hover:opacity-80 transition-opacity cursor-pointer\"\r\n                    />\r\n                  </Link>\r\n                  <div className=\"flex-1\">\r\n                    <Link\r\n                      to={`/profile/${follower.id}`}\r\n                      className=\"font-medium text-gray-900 hover:text-primary-600\"\r\n                    >\r\n                      {follower.nickname}\r\n                    </Link>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">{follower.signature}</p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                      {follower.followers_count} 粉丝\r\n                    </p>\r\n                  </div>\r\n                  <button \r\n                    onClick={() => followMutation.mutate(follower.id)}\r\n                    disabled={followMutation.isLoading}\r\n                    className={`px-3 py-1 text-sm rounded-md disabled:opacity-50 transition-all duration-200 ${\r\n                      follower.is_following\r\n                        ? 'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm'\r\n                        : 'bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md'\r\n                    }`}\r\n                  >\r\n                    {followMutation.isLoading ? (\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"w-3 h-3 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin\"></div>\r\n                        处理中\r\n                      </div>\r\n                    ) : (follower.is_following ? '已关注' : '关注')}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        );\r\n      \r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  if (userLoading) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto py-6\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n          <div className=\"animate-pulse\">\r\n            <div className=\"h-32 bg-gray-300 rounded-t-lg mb-4\"></div>\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"w-32 h-32 bg-gray-300 rounded-full\"></div>\r\n              <div className=\"flex-1\">\r\n                <div className=\"h-6 bg-gray-300 rounded w-1/3 mb-2\"></div>\r\n                <div className=\"h-4 bg-gray-300 rounded w-1/2\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!profileUser) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto py-6\">\r\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center\">\r\n          <p className=\"text-gray-500\">用户不存在</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto py-6\">\r\n      {/* 个人资料卡片 */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 mb-6\">\r\n        {/* 背景图 */}\r\n        <div \r\n          className=\"h-48 bg-gradient-to-r from-primary-400 to-primary-600 rounded-t-lg relative\"\r\n          style={{\r\n            backgroundImage: profileUser.background_url ? `url(${profileUser.background_url})` : undefined,\r\n            backgroundSize: 'cover',\r\n            backgroundPosition: 'center'\r\n          }}\r\n        >\r\n        </div>\r\n\r\n        <div className=\"px-6 pb-6\">\r\n          {/* 头像和基本信息 */}\r\n          <div className=\"flex flex-col sm:flex-row sm:items-end sm:space-x-6 -mt-16 relative\">\r\n            <div className=\"relative\">\r\n              <img\r\n                src={avatarPreview || profileUser?.avatar_url || '/default-avatar.svg'}\r\n                alt={profileUser?.nickname || '用户'}\r\n                className=\"w-32 h-32 rounded-full border-4 border-white shadow-lg\"\r\n                onError={(e) => {\r\n                  // 如果头像加载失败，使用默认头像\r\n                  e.currentTarget.src = '/default-avatar.svg';\r\n                }}\r\n              />\r\n              \r\n              {isOwnProfile && (\r\n                <button\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={uploadAvatarMutation.isLoading}\r\n                  className=\"absolute bottom-2 right-2 p-2 bg-primary-600 text-white rounded-full hover:bg-primary-700 disabled:opacity-50\"\r\n                >\r\n                  <Camera className=\"w-4 h-4\" />\r\n                </button>\r\n              )}\r\n              <input\r\n                ref={fileInputRef}\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleAvatarChange}\r\n                className=\"hidden\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex-1 mt-4 sm:mt-0\">\r\n              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\r\n                <div>\r\n                  <h1 className=\"text-2xl font-bold text-gray-900\">{profileUser.nickname}</h1>\r\n                  <p className=\"text-gray-600 mt-1\">{profileUser.signature}</p>\r\n                  <p className=\"text-sm text-gray-500 mt-2\">{profileUser.bio}</p>\r\n                  \r\n                  {/* 详细信息 */}\r\n                  <div className=\"mt-3 space-y-1\">\r\n                    {profileUser.birthday && (\r\n                      <div className=\"flex items-center text-sm text-gray-600\">\r\n                        <Calendar className=\"w-4 h-4 mr-2\" />\r\n                        {formatDate(profileUser.birthday)}\r\n                        {getAge(profileUser.birthday) && (\r\n                          <span className=\"ml-2 text-gray-500\">({getAge(profileUser.birthday)}岁)</span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                    {profileUser.gender && (\r\n                      <div className=\"flex items-center text-sm text-gray-600\">\r\n                        <Users className=\"w-4 h-4 mr-2\" />\r\n                        {getGenderText(profileUser.gender)}\r\n                      </div>\r\n                    )}\r\n                    {profileUser.location && (\r\n                      <div className=\"flex items-center text-sm text-gray-600\">\r\n                        <MapPin className=\"w-4 h-4 mr-2\" />\r\n                        {profileUser.location}\r\n                      </div>\r\n                    )}\r\n                    <div className=\"flex items-center text-sm text-gray-600\">\r\n                      <Calendar className=\"w-4 h-4 mr-2\" />\r\n                      加入于 {formatDate(profileUser.created_at)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center space-x-3 mt-4 sm:mt-0\">\r\n                  {isOwnProfile ? (\r\n                    <button\r\n                      onClick={() => setIsEditing(!isEditing)}\r\n                      className=\"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\"\r\n                    >\r\n                      {isEditing ? <X className=\"w-4 h-4 mr-2\" /> : <Edit3 className=\"w-4 h-4 mr-2\" />}\r\n                      {isEditing ? '取消' : '编辑资料'}\r\n                    </button>\r\n                  ) : (\r\n                    <>\r\n                      <button\r\n                        onClick={handleFollow}\r\n                        disabled={followMutation.isLoading}\r\n                        className={`flex items-center px-4 py-2 rounded-md disabled:opacity-50 transition-all duration-200 ${\r\n                          profileUser.is_following\r\n                            ? 'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm'\r\n                            : 'bg-primary-600 text-white hover:bg-primary-700 hover:shadow-md'\r\n                        }`}\r\n                      >\r\n                        {followMutation.isLoading ? (\r\n                          <div className=\"flex items-center\">\r\n                            <div className=\"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin\"></div>\r\n                            处理中...\r\n                          </div>\r\n                        ) : (\r\n                          <>\r\n                            {profileUser.is_following ? (\r\n                              <UserMinus className=\"w-4 h-4 mr-2\" />\r\n                            ) : (\r\n                              <UserPlus className=\"w-4 h-4 mr-2\" />\r\n                            )}\r\n                            {profileUser.is_following ? '已关注' : '关注'}\r\n                          </>\r\n                        )}\r\n                      </button>\r\n                      <button\r\n                        onClick={() => {\r\n                          if (targetUserId) {\r\n                            startConversationMutation.mutate(targetUserId);\r\n                          }\r\n                        }}\r\n                        disabled={startConversationMutation.isLoading}\r\n                        className=\"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        <MessageSquare className=\"w-4 h-4 mr-2\" />\r\n                        私信\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* 统计数据 */}\r\n              <div className=\"flex items-center space-x-6 mt-4\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xl font-bold text-gray-900\">{profileUser.posts_count || 0}</div>\r\n                  <div className=\"text-sm text-gray-500\">帖子</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xl font-bold text-gray-900\">{profileUser.followers_count || 0}</div>\r\n                  <div className=\"text-sm text-gray-500\">粉丝</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xl font-bold text-gray-900\">{profileUser.following_count || 0}</div>\r\n                  <div className=\"text-sm text-gray-500\">关注</div>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-xl font-bold text-gray-900\">{profileUser.likes_received || 0}</div>\r\n                  <div className=\"text-sm text-gray-500\">获赞</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* 编辑表单 */}\r\n          {isEditing && isOwnProfile && (\r\n            <form onSubmit={handleSubmit(onSubmit)} className=\"mt-6 p-6 bg-gray-50 rounded-lg\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">编辑个人资料</h3>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    昵称 *\r\n                  </label>\r\n                  <input\r\n                    {...register('nickname', { required: '请输入昵称' })}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                    placeholder=\"请输入昵称\"\r\n                  />\r\n                  {errors.nickname && (\r\n                    <p className=\"mt-1 text-sm text-red-600\">{errors.nickname.message}</p>\r\n                  )}\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    性别\r\n                  </label>\r\n                  <select\r\n                    {...register('gender')}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                  >\r\n                    <option value=\"\">请选择性别</option>\r\n                    <option value=\"male\">男</option>\r\n                    <option value=\"female\">女</option>\r\n                    <option value=\"other\">其他</option>\r\n                  </select>\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    生日\r\n                  </label>\r\n                  <input\r\n                    {...register('birthday')}\r\n                    type=\"date\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                  />\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    所在地\r\n                  </label>\r\n                  <input\r\n                    {...register('location')}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                    placeholder=\"请输入所在地\"\r\n                  />\r\n                </div>\r\n                \r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    个性签名\r\n                  </label>\r\n                  <input\r\n                    {...register('signature')}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                    placeholder=\"写点什么介绍一下自己...\"\r\n                    maxLength={200}\r\n                  />\r\n                </div>\r\n                \r\n              </div>\r\n              \r\n              <div className=\"mt-4\">\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  个人简介\r\n                </label>\r\n                <textarea\r\n                  {...register('bio')}\r\n                  rows={4}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                  placeholder=\"详细介绍一下自己...\"\r\n                  maxLength={500}\r\n                />\r\n                <div className=\"mt-1 text-right text-sm text-gray-500\">\r\n                  {watch('bio')?.length || 0} / 500\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex items-center justify-between mt-6\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={updateUserMutation.isLoading}\r\n                    className=\"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50\"\r\n                  >\r\n                    <Save className=\"w-4 h-4 mr-2\" />\r\n                    {updateUserMutation.isLoading ? '保存中...' : '保存'}\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setIsEditing(false);\r\n                      reset();\r\n                    }}\r\n                    className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\"\r\n                  >\r\n                    取消\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPrivateInfo(!showPrivateInfo)}\r\n                    className=\"flex items-center hover:text-gray-700\"\r\n                  >\r\n                    {showPrivateInfo ? <EyeOff className=\"w-4 h-4 mr-1\" /> : <Eye className=\"w-4 h-4 mr-1\" />}\r\n                    {showPrivateInfo ? '隐藏' : '显示'}隐私信息\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </form>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 标签页 */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n        <div className=\"border-b border-gray-200\">\r\n          <nav className=\"flex space-x-8 px-6\">\r\n            <button\r\n              onClick={() => setActiveTab('posts')}\r\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'posts'\r\n                  ? 'border-primary-500 text-primary-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <FileText className=\"w-4 h-4 inline mr-2\" />\r\n              我的帖子 ({profileUser.posts_count || 0})\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('likes')}\r\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'likes'\r\n                  ? 'border-primary-500 text-primary-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Heart className=\"w-4 h-4 inline mr-2\" />\r\n              我的点赞\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('following')}\r\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'following'\r\n                  ? 'border-primary-500 text-primary-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Users className=\"w-4 h-4 inline mr-2\" />\r\n              我的关注 ({profileUser.following_count || 0})\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('followers')}\r\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'followers'\r\n                  ? 'border-primary-500 text-primary-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <Users className=\"w-4 h-4 inline mr-2\" />\r\n              我的粉丝 ({profileUser.followers_count || 0})\r\n            </button>\r\n          </nav>\r\n        </div>\r\n\r\n        <div className=\"p-6\">\r\n          {renderTabContent()}\r\n        </div>\r\n      </div>\r\n\r\n      {/* 删除确认对话框 */}\r\n      {deleteConfirm.show && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <div className=\"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center\">\r\n                <Trash2 className=\"w-6 h-6 text-red-600\" />\r\n              </div>\r\n            </div>\r\n            <div className=\"text-center\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                删除帖子\r\n              </h3>\r\n              <p className=\"text-sm text-gray-500 mb-4\">\r\n                确定要删除帖子 <strong>\"{deleteConfirm.postTitle}\"</strong> 吗？此操作无法撤销。\r\n              </p>\r\n              <div className=\"flex space-x-3\">\r\n                <button\r\n                  onClick={cancelDeletePost}\r\n                  className=\"flex-1 bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 transition-colors\"\r\n                >\r\n                  取消\r\n                </button>\r\n                <button\r\n                  onClick={confirmDeletePost}\r\n                  disabled={deletePostMutation.isLoading}\r\n                  className=\"flex-1 bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50 transition-colors\"\r\n                >\r\n                  {deletePostMutation.isLoading ? '删除中...' : '删除'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Profile;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}